library IEEE;
use IEEE.STD_LOGIC_1164.all;
use IEEE.NUMERIC_STD.all;

entity TemperatureController is
    Port (
        clk          : in  std_logic;
        tempInicial  : in  std_logic_vector(7 downto 0); -- temperatura inicial
        estado       : in  std_logic;
        programa     : in  std_logic_vector(2 downto 0);
        tempUp       : in  std_logic;
        tempDown     : in  std_logic;
        ON_OFF       : in  std_logic;
        Run          : in  std_logic;
        tempUnidades : out std_logic_vector(3 downto 0);
        tempDezenas  : out std_logic_vector(3 downto 0);
        tempCentenas : out std_logic_vector(3 downto 0)
    );
end TemperatureController;

architecture Behavioral of TemperatureController is
    signal temperaturaFinal : INTEGER;
    signal tempInicialInt   : INTEGER;

begin
    process(clk)
    begin
        if rising_edge(clk) then
            if ON_OFF = '1' then
                -- Converter tempInicial para inteiro na primeira vez que enable Ã© '1'
                if temperaturaFinal = 20 then
                    tempInicialInt <= to_integer(unsigned(tempInicial));
                    temperaturaFinal <= tempInicialInt;
                end if;
                if Run = '0' then
                    if programa = "001" then
                        if tempUp = '1' then
                            temperaturaFinal <= temperaturaFinal + 10;
                        elsif tempDown = '1' then
                            temperaturaFinal <= temperaturaFinal - 10;
                        end if;
                    end if;
                else
                    if estado = '0' then
                        temperaturaFinal <= temperaturaFinal - 20;
                    else
                        temperaturaFinal <= temperaturaFinal + 10;
                    end if;
                end if;
            end if;
        end if;
    end process;

    process(temperaturaFinal)
    begin
        -- Extrair centenas, dezenas e unidades
        tempCentenas <= std_logic_vector(to_unsigned((temperaturaFinal / 100) mod 10, 4));
        tempDezenas  <= std_logic_vector(to_unsigned((temperaturaFinal / 10) mod 10, 4));
        tempUnidades <= std_logic_vector(to_unsigned(temperaturaFinal mod 10, 4));
    end process;
end Behavioral;